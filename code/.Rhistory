# Packages
pacman::p_load(metafor, MCMCglmm, tidyverse, rotl, phytools, corrplot, ape)
data <- read.csv("~/diving-meta-analysis/data/lab_dive_durations_armbased.csv")
genus <- as.data.frame(do.call("rbind", str_split(str_trim(data$species, side = "both"), " ")))
names(genus) <- c("genus", "species_new")
data <- cbind(data, genus)
m_sv <- function(mean, sd, n){
#page 148 Nakagawa et al 2015
(sd^2) / (n*(mean^2))
}
sd_sv <- function(n){
#page 148 Nakagawa et al 2015
(1/2)*(n-1)
}
data$mean_sv <- with(data, m_sv(mean, sd, n))
data$sd_sv <- with(data, sd_sv(n))
with(data, plot(log(mean) ~ log(sd)))
with(data, hist(log(mean)))
with(data, hist(log(sd)))
ggplot(data, aes(y = log(mean), x=T, colour= species))+
geom_point()
# Add in observation level random effects
data$obs <- 1:dim(data)[1]
# Scale by species / within species
sp <- split(data, data$species_genus_sp)
# Scale by species / within species
sp <- split(data, data$species_genus_sp)
data$T_w <- do.call("rbind", lapply(sp, function(x) scale(x$T, scale = FALSE)))
sp <- split(data, data$species_genus_sp)
# Scale by species / within species
sp <- split(data, data$species_genus_sp)
data$T_w <- do.call("rbind", lapply(sp, function(x) scale(x$T, scale = FALSE)))
# Scale by species / within species
sp <- split(data, data$species)
data$T_w <- do.call("rbind", lapply(sp, function(x) scale(x$T, scale = FALSE)))
# Packages
pacman::p_load(metafor, MCMCglmm, tidyverse, rotl, phytools, corrplot, ape)
# Remove stuff
rm(list=ls())
# Remove stuff
rm(list=ls())
data <- read.csv("~/diving-meta-analysis/data/lab_dive_durations_armbased.csv")
genus <- as.data.frame(do.call("rbind", str_split(str_trim(data$species, side = "both"), " ")))
names(genus) <- c("genus", "species_new")
data <- cbind(data, genus)
m_sv <- function(mean, sd, n){
#page 148 Nakagawa et al 2015
(sd^2) / (n*(mean^2))
}
#page 148 Nakagawa et al 2015
(1/2)*(n-1)
}
data$mean_sv <- with(data, m_sv(mean, sd, n))
data$sd_sv <- with(data, sd_sv(n))
sd_sv <- function(n){
#page 148 Nakagawa et al 2015
(1/2)*(n-1)
}
data$mean_sv <- with(data, m_sv(mean, sd, n))
data$sd_sv <- with(data, sd_sv(n))
# Scale by species / within species
sp <- split(data, data$species_genus_sp)
# Scale by species / within species
sp <- split(data, data$species)
View(sp)
data$T_w <- do.call("rbind", lapply(sp, function(x) scale(x$T, scale = FALSE)))
